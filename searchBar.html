<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>WeUI</title>
    <link rel="stylesheet" href="weui.min.css"/>
</head>
<body>
<div class="container" id="container">

<div class="hd">
    <h1 class="page_title">searchBar</h1>
</div>
<div class="bd">
    <!--<a href="javascript:;" class="weui_btn weui_btn_primary">点击展现searchBar</a>-->
    <div class="weui_search_bar" id="search_bar">
        <form class="weui_search_outer">
            <div class="weui_search_inner">
                <i class="weui_icon_search"></i>
                <input type="search" class="weui_search_input" id="search_input" placeholder="搜索" required/>
                <a href="javascript:" class="weui_icon_clear" id="search_clear"></a>
            </div>
            <label for="search_input" class="weui_search_text" id="search_text">
                <i class="weui_icon_search"></i>
                <span>搜索</span>
            </label>
        </form>
        <a href="javascript:" class="weui_search_cancel" id="search_cancel">取消</a>
    </div>
    <div class="weui_cells weui_cells_access search_show" id="search_show">
        <div class="weui_cell">
            <div class="weui_cell_bd weui_cell_primary">
                <p>实时搜索文本</p>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_bd weui_cell_primary">
                <p>实时搜索文本</p>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_bd weui_cell_primary">
                <p>实时搜索文本</p>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_bd weui_cell_primary">
                <p>实时搜索文本</p>
            </div>
        </div>
    </div>
</div>

</div>
<script type="text/javascript" src="zepto.min.js"></script>
<script type="text/javascript">
    
// searchbar
$('#container').on('focus', '#search_input', function () {
    var $weuiSearchBar = $('#search_bar');
    $weuiSearchBar.addClass('weui_search_focusing');
}).on('blur', '#search_input', function () {
    var $weuiSearchBar = $('#search_bar');
    $weuiSearchBar.removeClass('weui_search_focusing');
    if ($(this).val()) {
        $('#search_text').hide();
    } else {
        $('#search_text').show();
    }
}).on('input', '#search_input', function () {
    var $searchShow = $("#search_show");
    if ($(this).val()) {
        $searchShow.show();
    } else {
        $searchShow.hide();
    }
}).on('touchend', '#search_cancel', function () {
    $("#search_show").hide();
    $('#search_input').val('');
}).on('touchend', '#search_clear', function () {
    $("#search_show").hide();
    $('#search_input').val('');
});
    
// .container 设置了 overflow 属性, 导致 Android 手机下输入框获取焦点时, 输入法挡住输入框的 bug
// 相关 issue: https://github.com/weui/weui/issues/15
// 解决方法:
// 0. .container 去掉 overflow 属性, 但此 demo 下会引发别的问题
// 1. 参考 http://stackoverflow.com/questions/23757345/android-does-not-correctly-scroll-on-input-focus-if-not-body-element
//    Android 手机下, input 或 textarea 元素聚焦时, 主动滚一把
if (/Android/gi.test(navigator.userAgent)) {
    window.addEventListener('resize', function () {
        if (document.activeElement.tagName == 'INPUT' || document.activeElement.tagName == 'TEXTAREA') {
            window.setTimeout(function () {
                document.activeElement.scrollIntoViewIfNeeded();
            }, 0);
        }
    })
}
    
</script>
</body>